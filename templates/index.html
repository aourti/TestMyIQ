{% extends "base.html" %}

{% block content %}
<style>
    /* Override base styles for proper layout and visibility */
    body {
        background: #f5f7fa !important;
        min-height: 100vh;
        margin: 0;
        padding: 0;
    }
    
    /* Main content container */
    .index-container {
        max-width: 900px;
        margin: 2rem auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        padding: 40px;
        position: relative;
        overflow: hidden;
    }
    
    /* All text should be dark */
    p, span, div, li, h1, h2, h3, h4, h5, h6 {
        color: #333;
    }
    
    /* Welcome message styles */
    .welcome-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .welcome-header * {
        color: white !important;
    }
    
    .welcome-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: pulse 4s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.5; }
        50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .greeting {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
    }
    
    .user-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
        position: relative;
        z-index: 1;
    }
    
    .stat-mini {
        background: rgba(255, 255, 255, 0.2);
        padding: 1rem;
        border-radius: 10px;
        text-align: center;
    }
    
    .stat-mini h4 {
        margin: 0;
        font-size: 1.5em;
        font-weight: bold;
    }
    
    .stat-mini p {
        margin: 0;
        font-size: 0.9em;
        opacity: 0.9;
    }
    
    /* Achievement badges */
    .achievements {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .badge-custom {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85em;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    /* Daily quote fix */
    .daily-quote {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        border-left: 4px solid #667eea;
        font-style: italic;
        position: relative;
        color: #555;
    }
    
    .daily-quote p {
        color: #555;
        margin: 0;
    }
    
    .daily-quote::before {
        content: '"';
        font-size: 3em;
        position: absolute;
        top: -10px;
        left: 10px;
        color: #667eea;
        opacity: 0.3;
    }
    
    /* Quick actions fix */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .action-card {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 15px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        color: #333;
    }
    
    .action-card h3,
    .action-card p {
        color: #333;
        margin: 0;
    }
    
    .action-card h3 {
        margin-bottom: 0.5rem;
        font-size: 1.3em;
    }
    
    .action-card p {
        font-size: 0.9em;
        opacity: 0.8;
    }
    
    .action-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .action-card.primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .action-card.primary h3,
    .action-card.primary p {
        color: white !important;
    }
    
    .action-card .icon {
        font-size: 2.5em;
        margin-bottom: 0.5rem;
    }
    
    /* Progress visualization */
    .progress-overview {
        background: #f8f9fa;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }
    
    .progress-item {
        margin-bottom: 1.5rem;
    }
    
    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
    
    .progress {
        height: 10px;
        background: #e9ecef;
        border-radius: 5px;
        overflow: hidden;
    }
    
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        transition: width 1s ease;
        border-radius: 5px;
    }
    
    /* Fix test information section */
    .question {
        background: #f8f9fa;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        color: #333;
    }
    
    .question h3 {
        color: #333;
        margin-bottom: 1.5rem;
    }
    
    .question p,
    .question li {
        color: #555;
        line-height: 1.6;
    }
    
    .adaptive-info {
        background: #e7f3ff;
        padding: 1.5rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        border-left: 4px solid #667eea;
    }
    
    .adaptive-info h4 {
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .adaptive-info p {
        color: #555;
        margin: 0;
    }
    
    /* Cognitive domains styling */
    .cognitive-domains {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    .domain-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(102, 126, 234, 0.05);
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .domain-item:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(10px);
    }
    
    .domain-icon {
        width: 48px;
        height: 48px;
        object-fit: contain;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        flex-shrink: 0;
    }
    
    .domain-item div {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .domain-item strong {
        color: #333;
        font-size: 1.1em;
        font-weight: 600;
    }
    
    .domain-item span {
        color: #666;
        font-size: 0.9em;
    }
    
    /* Leaderboard preview */
    .leaderboard-preview {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }
    
    .leaderboard-preview h3 {
        color: #333;
        margin-bottom: 1rem;
    }
    
    .leaderboard-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem;
        border-bottom: 1px solid #e9ecef;
        color: #333;
    }
    
    .leaderboard-item:last-child {
        border-bottom: none;
    }
    
    .rank {
        font-weight: bold;
        color: #667eea;
        margin-right: 1rem;
    }
    
    /* Animations */
    .fade-in {
        animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .container {
            margin: 1rem;
            padding: 25px;
        }
        
        .greeting {
            font-size: 1.5em;
        }
        
        .user-stats {
            grid-template-columns: 1fr 1fr;
        }
        
        .domain-icon {
            width: 40px;
            height: 40px;
        }
        
        .domain-item {
            padding: 0.75rem;
        }
        
        .domain-item:hover {
            transform: translateX(5px);
        }
    }
    
    @media (max-width: 480px) {
        .domain-icon {
            width: 32px;
            height: 32px;
        }
        
        .domain-item {
            padding: 0.5rem;
            gap: 0.75rem;
        }
        
        .domain-item strong {
            font-size: 1em;
        }
        
        .domain-item span {
            font-size: 0.8em;
        }
    }
</style>

<div class="index-container fade-in">
    {% if current_user.is_authenticated %}
    <!-- Personalized Welcome Header -->
    <div class="welcome-header">
        <div class="greeting" id="greeting">
            <!-- Greeting will be set by JavaScript -->
        </div>
        <p>Ready to challenge your mind today?</p>
        
        {% if user_stats %}
        <div class="user-stats">
            <div class="stat-mini">
                <h4>{{ user_stats.total_tests }}</h4>
                <p>Tests Taken</p>
            </div>
            <div class="stat-mini">
                <h4>{{ user_stats.avg_score }}%</h4>
                <p>Average Score</p>
            </div>
            <div class="stat-mini">
                <h4>{{ user_stats.best_score }}%</h4>
                <p>Best Score</p>
            </div>
            <div class="stat-mini">
                <h4>{{ user_stats.streak }}</h4>
                <p>Day Streak üî•</p>
            </div>
        </div>
        
        <div class="achievements">
            {% if user_stats.total_tests >= 5 %}
            <span class="badge-custom">üèÜ Dedicated Learner</span>
            {% endif %}
            {% if user_stats.best_score >= 90 %}
            <span class="badge-custom">‚≠ê High Achiever</span>
            {% endif %}
            {% if user_stats.streak >= 7 %}
            <span class="badge-custom">üî• Week Warrior</span>
            {% endif %}
            {% if user_stats.perfect_scores > 0 %}
            <span class="badge-custom">üíØ Perfectionist</span>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    <!-- Daily Motivational Quote -->
    <div class="daily-quote">
        <p id="daily-quote">Loading inspiration...</p>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <div class="action-card primary" onclick="window.location.href='{{ url_for('test.start') }}'">
            <div class="icon" style="display: flex; align-items: center; justify-content: center; height: 70px;">
                <!-- Try logo first, fallback to styled text -->
                <img id="homepage-logo" 
                     src="{{ url_for('static', filename='images/testmyiq_logo.png') }}" 
                     alt="TestMyIQ Logo" 
                     style="max-width: 60px; max-height: 60px; object-fit: contain;" 
                     onload="console.log('‚úÖ Homepage logo loaded'); document.getElementById('homepage-fallback').style.display='none';"
                     onerror="console.log('‚ö†Ô∏è Using text fallback'); this.style.display='none'; document.getElementById('homepage-fallback').style.display='flex';" />
                <div id="homepage-fallback" style="display: none; flex-direction: column; align-items: center; color: white; font-weight: bold;">
                    <div style="font-size: 24px; margin-bottom: 4px;">TestMyIQ</div>
                    <div style="font-size: 12px; opacity: 0.8;">.ai</div>
                </div>
            </div>
            <h3>Start New Test</h3>
            <p>Begin your adaptive IQ assessment</p>
        </div>
        
        <div class="action-card" onclick="window.location.href='{{ url_for('profile.index') }}'">
            <div class="icon">üìä</div>
            <h3>View Progress</h3>
            <p>Track your improvement over time</p>
        </div>
        
        <div class="action-card" onclick="showPracticeMode()">
            <div class="icon">üéØ</div>
            <h3>Practice Mode</h3>
            <p>Focus on specific categories</p>
        </div>
    </div>
    
    {% if recent_performance %}
    <!-- Progress Overview -->
    <div class="progress-overview">
        <h3>Your Progress This Week</h3>
        {% for category, data in recent_performance.items() %}
        <div class="progress-item">
            <div class="progress-label">
                <span>{{ category }}</span>
                <span>{{ data.score }}%</span>
            </div>
            <div class="progress">
                <div class="progress-bar" style="width: {{ data.score }}%"></div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% else %}
    <!-- Non-authenticated view with same styling -->
    <div class="welcome-header">
        <div class="greeting">Welcome to TestMyIQ.ai!</div>
        <p>Discover your cognitive potential with our adaptive assessment</p>
    </div>
    
    <div class="daily-quote">
        <p>"The mind is not a vessel to be filled, but a fire to be kindled." - Plutarch</p>
    </div>
    
    <div class="quick-actions">
        <div class="action-card primary" onclick="window.location.href='{{ url_for('auth.register') }}'">
            <div class="icon">üöÄ</div>
            <h3>Get Started</h3>
            <p>Create your free account</p>
        </div>
        
        <div class="action-card" onclick="window.location.href='{{ url_for('auth.login') }}'">
            <div class="icon">üîë</div>
            <h3>Sign In</h3>
            <p>Continue your journey</p>
        </div>
        
        <div class="action-card" onclick="showDemo()">
            <div class="icon">üëÅÔ∏è</div>
            <h3>View Demo</h3>
            <p>See how it works</p>
        </div>
    </div>
    {% endif %}
    
    <!-- Test Information -->
    <div class="question">
        <h3>About Our Adaptive IQ Assessment</h3>
        
        <div class="adaptive-info">
            <h4>üéØ Adaptive Testing Technology</h4>
            <p>This assessment uses Computerized Adaptive Testing (CAT) to precisely measure your cognitive abilities. Questions automatically adjust to your performance level, providing a more accurate and efficient evaluation.</p>
        </div>
        
        <p style="font-size: 1.1em; line-height: 1.6; color: #555; margin-bottom: 20px;">
            This comprehensive assessment measures five key cognitive domains:
        </p>
        <div class="cognitive-domains">
            <div class="domain-item">
                <img src="{{ url_for('static', filename='images/verbal_comprehension.png') }}" alt="Verbal Comprehension" class="domain-icon" />
                <div>
                    <strong>Verbal Comprehension</strong>
                    <span>Language and verbal reasoning</span>
                </div>
            </div>
            <div class="domain-item">
                <img src="{{ url_for('static', filename='images/perceptual_reasoning.png') }}" alt="Perceptual Reasoning" class="domain-icon" />
                <div>
                    <strong>Perceptual Reasoning</strong>
                    <span>Visual-spatial processing</span>
                </div>
            </div>
            <div class="domain-item">
                <img src="{{ url_for('static', filename='images/working_memory.png') }}" alt="Working Memory" class="domain-icon" />
                <div>
                    <strong>Working Memory</strong>
                    <span>Information retention and manipulation</span>
                </div>
            </div>
            <div class="domain-item">
                <img src="{{ url_for('static', filename='images/processing_speed.png') }}" alt="Processing Speed" class="domain-icon" />
                <div>
                    <strong>Processing Speed</strong>
                    <span>Cognitive efficiency</span>
                </div>
            </div>
            <div class="domain-item">
                <img src="{{ url_for('static', filename='images/fluid_reasoning.png') }}" alt="Fluid Reasoning" class="domain-icon" />
                <div>
                    <strong>Fluid Reasoning</strong>
                    <span>Novel problem solving</span>
                </div>
            </div>
        </div>
    </div>
    
    {% if current_user.is_authenticated and leaderboard %}
    <!-- Leaderboard Preview -->
    <div class="leaderboard-preview">
        <h3>Top Performers This Week</h3>
        {% for entry in leaderboard[:5] %}
        <div class="leaderboard-item">
            <div>
                <span class="rank">#{{ loop.index }}</span>
                <span>{{ entry.username }}</span>
            </div>
            <span>{{ entry.score }}%</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<script>
// Personalized greeting based on time of day
function setGreeting() {
    const hour = new Date().getHours();
    const greetingEl = document.getElementById('greeting');
    let timeGreeting;
    
    if (hour < 5) {
        timeGreeting = "üåô Burning the midnight oil";
    } else if (hour < 12) {
        timeGreeting = "‚òÄÔ∏è Good morning";
    } else if (hour < 17) {
        timeGreeting = "üå§Ô∏è Good afternoon";
    } else if (hour < 20) {
        timeGreeting = "üåÖ Good evening";
    } else {
        timeGreeting = "üåô Good night";
    }
    
    {% if current_user.is_authenticated %}
    greetingEl.textContent = `${timeGreeting}, {{ current_user.username }}!`;
    {% else %}
    greetingEl.textContent = `${timeGreeting}!`;
    {% endif %}
}

// Daily motivational quotes
const quotes = [
    "Intelligence is the ability to adapt to change. - Stephen Hawking",
    "The mind is everything. What you think you become. - Buddha",
    "Learning never exhausts the mind. - Leonardo da Vinci",
    "The capacity to learn is a gift; the ability to learn is a skill; the willingness to learn is a choice. - Brian Herbert",
    "Education is not the learning of facts, but the training of the mind to think. - Albert Einstein",
    "The beautiful thing about learning is that no one can take it away from you. - B.B. King",
    "Anyone who stops learning is old, whether at twenty or eighty. - Henry Ford",
    "The more that you read, the more things you will know. - Dr. Seuss"
];

function setDailyQuote() {
    const quoteEl = document.getElementById('daily-quote');
    const today = new Date().getDay();
    quoteEl.textContent = quotes[today % quotes.length];
}

// Initialize personalization
document.addEventListener('DOMContentLoaded', () => {
    setGreeting();
    setDailyQuote();
    
    // Animate progress bars
    setTimeout(() => {
        document.querySelectorAll('.progress-bar').forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 100);
        });
    }, 500);
});

// Show practice mode selection
function showPracticeMode() {
    // This would open a modal or navigate to practice selection
    alert('Practice mode coming soon! You\'ll be able to focus on specific categories.');
}

// Show demo
function showDemo() {
    // This would show a demo or tutorial
    alert('Demo mode coming soon! See how our adaptive testing works.');
}

// Add some interactive effects
document.querySelectorAll('.action-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px) scale(1.02)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0) scale(1)';
    });
});
</script>
{% endblock %}